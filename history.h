#ifndef HISTORY_H
#define HISTORY_H

#include "field.h"  
#include <stdbool.h>

// Максимальное количество сохранённых состояний (защита от переполнения памяти)
#define MAX_UNDO_DEPTH 1000

/**
 * Структура State представляет одно сохранённое состояние поля.
 * - field: указатель на копию поля в тот момент
 * - next: указатель на предыдущее состояние (нижний элемент стека)
 */
typedef struct State {
    Field* field;          // Копия поля
    struct State* next;    // Следующий (более старый) элемент стека
} State;

/**
 * Структура History управляет стеком состояний.
 * - top: указатель на самое свежее сохранённое состояние (вершина стека)
 * - count: текущее количество сохранённых состояний
 */
typedef struct {
    State* top;    // Вершина стека (последнее сохранённое состояние)
    int count;     // Сколько состояний в стеке
} History;

/**
 * Создаёт новый пустой стек истории.
 * Возвращает указатель на структуру History.
 */
History* create_history(void);

/**
 * Сохраняет копию текущего состояния поля в стек.
 * Если стек полон, новое состояние не добавляется.
 */
void push_state(History* h, Field* f);

/**
 * Восстанавливает предыдущее состояние поля из стека.
 * Удаляет верхний элемент стека и копирует его данные в current.
 * Возвращает true при успехе, false если стек пуст.
 */
bool pop_state(History* h, Field* current);

/**
 * Полностью освобождает память, выделенную под стек истории.
 */
void free_history(History* h);

#endif